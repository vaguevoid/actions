name: "Share a Void game on Steam"
author: "Jake Gordon <jake@void.dev>"
description: "Build, Package, and Deploy a Void game to Steam"
inputs:
  buildTask:
    description: "(optional) bun task to build the game"
    required: false
    default: "build"
  buildDescription:
    description: "Description for this build"
  executable:
    description: "executable file name prefix (not including extension)"
    default: "void"
  outDir:
    description: "output directory for build assets generated by build step"
    default: "dist"
  releasePath:
    description: "path to packaged releases"
    default: "release"
  username:
    description: "Steam user name"
    required: true
  configVdf:
    description: "A steamcmd authorization config.vdf file (base64 encoded)"
    required: true
  appId:
    description: "Steam Application ID"
    required: true
  windowsDepotId:
    description: "Steam Depot ID for Windows binaries"
  macosDepotId:
    description: "Steam Depot ID for MacOS binaries"
  linuxDepotId:
    description: "Steam Depot ID for Linux binaries"
  setLiveBranch:
    description: "A custom Steam branch to set live with this build ('default' not allowed)"

runs:
  using: "composite"
  steps:
    - name: "Build"
      uses: "vaguevoid/actions/build/vite@v1"
      with:
        taskName: ${{ inputs.buildTask }}
        deployTarget: "steam"

    - name: "Package for Windows"
      uses: "vaguevoid/actions/package/electron@v1"
      if: ${{ inputs.windowsDepotId != '' }}
      with:
        bundle: ${{ inputs.outDir }}
        releasePath: ${{ inputs.releasePath }}
        executable: ${{ inputs.executable }}
        platform: win32
        arch: x64

    - name: "Package for MacOS"
      uses: "vaguevoid/actions/package/electron@v1"
      if: ${{ inputs.macosDepotId != '' }}
      with:
        bundle: ${{ inputs.outDir }}
        releasePath: ${{ inputs.releasePath }}
        executable: ${{ inputs.executable }}
        platform: darwin
        arch: x64

    - name: "Package for Linux"
      uses: "vaguevoid/actions/package/electron@v1"
      if: ${{ inputs.linuxDepotId != '' }}
      with:
        bundle: ${{ inputs.outDir }}
        releasePath: ${{ inputs.releasePath }}
        executable: ${{ inputs.executable }}
        platform: linux
        arch: x64

    - name: "Deploy"
      uses: "vaguevoid/actions/deploy/steam@v1"
      with:
        buildDescription: ${{ inputs.buildDescription }}
        executable: ${{ inputs.executable }}
        releasePath: ${{ inputs.releasePath }}
        username: ${{ inputs.username }}
        configVdf: ${{ inputs.configVdf }}
        appId: ${{ inputs.appId }}
        windowsDepotId: ${{ inputs.windowsDepotId }}
        macosDepotId: ${{ inputs.macosDepotId }}
        linuxDepotId: ${{ inputs.linuxDepotId }}
        setLiveBranch: ${{ inputs.setLiveBranch }}
